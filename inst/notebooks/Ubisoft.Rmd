---
title: "R Notebook"
output: html_notebook
---

```{r}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(stringr))
```

This is an example using [Ubisoft](https://github.com/humbertcostas/vulnmine) data. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 
```{r}
# encoded UCS-2 LE with BOM -> converted with notepad and removed noisy row 20045
ubisoft_url <- "https://github.com/humbertcostas/vulnmine/raw/master/data/csv/v_GS_ADD_REMOVE_PROGRAMS.csv"
t <- tempfile(fileext = ".csv")
download.file(ubisoft_url, t, quiet = T)
raw_cnt <- readr::read_file_raw(file = t)
# raw_cnt2 <- raw_cnt[raw_cnt != 00]

# kk <- readr::read_file_raw(t)
# kk2 <- stringi::stri_conv(kk, to = "UTF-8")

# raw_cnt <- rawToChar(raw_cnt)
# raw_cnt <- rawToChar(raw_cnt[raw_cnt != 00], multiple = T)
raw_cnt <- rawToChar(raw_cnt[raw_cnt != 00])

raw_df <- readr::read_delim(I(raw_cnt), delim = "|", trim_ws = T, show_col_types = FALSE, locale = readr::locale(asciify = T))
df_ubi_raw <- raw_df
```


```{r}
# df_ubi_raw <- read.csv("../extdata/ubisoft3.csv", header = T, sep = "|", fill = T,encoding = readr::locale(asciify = T))

```


```{r}
df_ubi <- df_ubi_raw %>% select(Publisher0, DisplayName0, Version0)
names(df_ubi) <- c("vendor", "product", "version")
```


```{r}

write.csv(df_ubi[, c("product", "vendor", "version")], 
          "../extdata/ubisoft_clean2.csv", row.names = FALSE)

```


```{r}
# df <- mitre::cpe_sccm_inventory(path_sccm = "../extdata/ubisoft_clean2.csv", verbose = T)
# df <- mitre::cpe_sccm_inventory(df_sccm = df_ubi, verbose = T)


df <- mitre::cpe_sccm_inventory(path_sccm = "../extdata/ubisoft_clean.csv", verbose = T)

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.
```{r}
df_sccm <- unique(df)
```

```{r}
df_test <- data.frame(id = 1:length(unique(df_sccm$title)), title = unique(df_sccm$title))


```


When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
