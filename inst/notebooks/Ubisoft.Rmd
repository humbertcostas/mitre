---
title: "Ubisoft Cybersecurity Analysis"
output: html_notebook
---

```{r}
num_samples <- 50
p_seed <- 43
verbose <- TRUE

set.seed(p_seed)
```

Load required packages.

```{r}
suppressPackageStartupMessages(library(dplyr))
# suppressPackageStartupMessages(library(mitre))
suppressPackageStartupMessages(library(kableExtra))
```

Load NLP requirements.

```{r}
# reticulate::use_condaenv("transf")
# 
# library(text)
# 
# textrpp_initialize(condaenv = "transf", prompt = FALSE)
```

This is an example using [Ubisoft](https://github.com/humbertcostas/vulnmine) data. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 
```{r}
# encoded UCS-2 LE with BOM
ubisoft_url <- "https://github.com/humbertcostas/vulnmine/raw/master/data/csv/v_GS_ADD_REMOVE_PROGRAMS.csv"
df_ubi_raw <- read.csv2(file = ubisoft_url, as.is = T, sep = "|", 
                        fileEncoding = "UCS-2", encoding = "UTF-16")
df_ubi_raw$id <- 1:nrow(df_ubi_raw)
```

Group inventory and get unique values for vendor, product and version:

```{r}
df_ubi <- df_ubi_raw %>% 
          select(Publisher0, DisplayName0, Version0) %>%
          rename("vendor" = "Publisher0", 
                 "product" = "DisplayName0", 
                 "version" = "Version0") %>% 
          group_by(vendor, product, version) %>% 
          summarise(n = n(), .groups = 'drop') %>%
          ungroup() %>%
          arrange(desc(n)) %>%
          mutate(id = seq_along(n)) %>%
          select(id, vendor, product, version, n)
df_ubi$id <- 1:nrow(df_ubi)

df_ubi_sample <- head(df_ubi, num_samples)

kbl(df_ubi_sample) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


```{r}
df_inventory <- mitre::cpe_make_title(df_inventory = df_ubi_sample, verbose = verbose)
df_inventory <- mitre::cpe_generate(df_inventory = df_inventory, verbose = verbose)
```

```{r}
kbl(df_inventory) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
df <- mitre::cpe_find_vulnerabilities(df_inventory, verbose)
```

```{r}
kbl(df) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```
